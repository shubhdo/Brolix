'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (base64content, tempDirectory) {
  var buf = new Buffer(base64content, 'base64');
  var result = {};
  return (0, _decompress2.default)()(buf).then(function (files) {
    return _bluebird2.default.all(files.map(function (f) {
      if (f.path.includes('.xml')) {
        return parseString(f.data.toString()).then(function (r) {
          return result[f.path] = r;
        });
      }

      if (f.path.includes('xl/media/') || f.path.includes('.bin')) {
        result[f.path] = f.data.toString('base64');
      }

      if (!result[f.path]) {
        result[f.path] = f.data.toString('utf8');
      }
    }));
  }).then(function () {
    return JSON.stringify(result);
  });
};

var _decompress = require('./decompress');

var _decompress2 = _interopRequireDefault(_decompress);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _xml2js = require('xml2js');

var _xml2js2 = _interopRequireDefault(_xml2js);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var parseString = _bluebird2.default.promisify(_xml2js2.default.parseString);